; Emergency WiFi Bridge - POC Configuration
; Heltec WiFi LoRa 32 V2 with WiFi AP instead of BLE

[env:heltec_v2_pwa_poc]
board_level = extra
extends = esp32_base
board = heltec_wifi_lora_32_V2

build_flags =
  ${esp32_base.build_flags}
  -D HELTEC_V2_0
  -I variants/esp32/heltec_v2

  ; Disable BLE (not needed for WiFi AP mode)
  -D MESHTASTIC_EXCLUDE_BLUETOOTH=1
  -D DISABLE_BLUETOOTH=1
  -D CONFIG_BT_ENABLED=0

  ; Enable WiFi AP features
  -D ENABLE_WIFI_AP=1
  -D ENABLE_EMERGENCY_BRIDGE=1

  ; Pre-configure LoRa region (EU = 868 MHz, no setup prompt)
  ; For US use: meshtastic_Config_LoRaConfig_RegionCode_US
  -D USERPREFS_CONFIG_LORA_REGION=meshtastic_Config_LoRaConfig_RegionCode_EU_868

  ; Debug flags
  -D DEBUG_PORT=Serial
  -D CORE_DEBUG_LEVEL=3

; Additional libraries for WiFi AP and WebSocket
lib_deps =
  ${esp32_base.lib_deps}
  https://github.com/me-no-dev/ESPAsyncWebServer.git
  https://github.com/Links2004/arduinoWebSockets.git
  bblanchon/ArduinoJson@^6.21.3

; Remove BLE libraries
lib_ignore =
  NimBLE-Arduino
  ESP32 BLE Arduino

; Exclude Bluetooth source files from compilation
build_src_filter =
  ${esp32_base.build_src_filter}
  -<nimble/>
  -<bluetooth/>
  -<BluetoothCommon.cpp>
  -<BluetoothStatus.h>

; SPIFFS for web app storage - use huge_app partition for POC
board_build.filesystem = littlefs
board_build.partitions = huge_app.csv

; Monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
